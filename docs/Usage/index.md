# Usage

## Basic

The SDK includes an autoloader generated by Composer.  This will automatically load the appropriate classes when required across all dependencies of the SDK.  You must include this file first.
```php
require_once "vendor/autoload.php";
```

The Kazoo SDK uses [PHP namespaces](http://php.net/manual/en/language.namespaces.php) to keep class names from conflicting and encapsulating functionality.  When creating classes, if you have not imported the namespace via the PHP reserved word `use` then you must prefix the SDK class names with `\Kazoo`.  For example:
```php
$authToken = new \Kazoo\AuthToken\User('username', 'password', 'realm');
$sdk = new \Kazoo\SDK($authToken, $options);
```

## Resources

A resource represents an API component and is futher divided into Entities and Collections.

### Entities

Entities represent a _thing_ on the Kazoo platform and will have a singular class name.  When creating an entity instance without chaining off a collection or the SDK object you must provide one of those as the first parameter.  The second parameter should the be entity ID, if there is one and subsequent parameters will varry depending on the entity;

For example, these represent the same entity:
```php
$user = $sdk->Account()->User("XXX");

$account = $sdk->Account();
$user = \Kazoo\Api\Entity\User($account, "XXX");
```

The standard methods of a entity are:
* *fetch()* - Gets all the properties of the entity from the database.  If the entity is newly created (has no id) this will throw an exception.
* *save()* - This will store the entity in the Kazoo platform.  It will create a new resource or update an existing if it has an id.
* *remove()* - This will delete the entity from the Kazoo platform.  If the entity is newly created (has no id) this will throw an exception.
* *duplicate()* - Use the properites of the current entity as a template and create a new instance (with no id).
* *toJson()* - Output the JSON representation of the enitity.  If a entity is treated as a string this will automatically be invoked.
* *fromJson($json)* - Propulate the entity properties from a JSON representation
* *getId()* - Get the entity ID
* *reset()* - Remove the entity properties and id from the instance

Properties of the entity can be read and written via standard PHP syntax.

For example:
```php
$device = $sdk->Account()->Device();
$device->name = "Test";
$device->save();
echo $device;
```

## Collections

A collection is a group of elements that represent entities or lists of information.  These have plural class names.

Unlike entities, collections and their elements can not be changed as it is only a partial representation of what is present in the system.

The standard methods of collections are:
* *fetch($filter)* - Gets all the elements of a collection from the database.  The filter is an optional array of Kazoo API filters in key/value form.
* *count()* - Returns the number of elements in the collection
* *toJson()* - Output the JSON representation of the collection.  If a collection is treated as a string this will automatically be invoked.
* *fromJson($json)* - Propulate the collection elements from a JSON representation
* *rewind()*/*current()*/*key()*/*next()*/*valid()* - These provide a PHP [iterator](http://php.net/manual/en/class.iterator.php) interface for functions such as `foreach`

Properties of a collection can not be written to, attempting to do so will cause an exception.

Additionally, each element of a collection has partial values of an entity it represents which can also be read but not written to.  To access the entity from a element you must use the `fetch()` method.

For example, to echo the JSON representation of the partial values of each element:
```php
$devices = $sdk->Account()->Devices();
foreach($devices as $element) {
    echo $element;
}
```

To get the entity from a collection element you must explicity request the element be fetched.
```php
$users = $sdk->Account()->Users();
foreach($users as $element) {
    $user = $element->fetch();
    $user->require_password_update = true;
    $user->save();
}
```

## Chains

The SDK is written to reflect the Kazoo API.  This API is built such that a developer "chains" together resources to issue a request to the system.

For example, to access a list of users in an account you would use the API issue the following request:

_"From the SDK, in the account (I authenticated the SDK with) get the users."_
```php
$users = $sdk->Account()->Users();
```

To access a single user, you would issue the following request:

_"From the SDK, in the account (I authenticated the SDK with) get the user xxx."_
```php
$user = $sdk->Account()->User("XXX");
```

To access a user's CDRs in another account you would issue the following request:

_"From the SDK, in account XXX and for the user YYY get the cdrs."_
```php
$users = $sdk->Account("XXX")->User("YYY")->cdrs();
```

# More Info
* [Accounts](accounts.md)
* [Devices](devices.md)
* [Users](users.md)
* [Voicemail Boxes](vmboxes.md)
* [ACls](acls.md)
